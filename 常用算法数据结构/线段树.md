1. 节点表示范围为区间
2. 懒惰标记、延迟更新

参考代码（待验证）

```java
class SegmentTree {
    int sum;
    int start;
    int end;
    SegmentTree left;
    SegmentTree right;
    int lazy;

    public SegmentTree(int start, int end) {
        this.sum = 0;
        this.start = start;
        this.end = end;
        this.left = null;
        this.right = null;
        this.lazy = 0;
    }

    public static SegmentTree buildTree(int[] nums, int l, int r) {
        SegmentTree node = new SegmentTree(l, r);
        if (l == r) {
            node.sum = nums[l];
            return node;
        }
        int mid = l + ((r - l) >> 1);
        node.left = buildTree(nums, l, mid);
        node.right = buildTree(nums, mid + 1, r);
        node.sum = node.left.sum;
        node.sum += node.right.sum;
        return node;
    }

    public static void update(SegmentTree node, int l, int r, int dt) {
        if (l <= node.start && r >= node.end) {
            node.sum += (node.end - node.start + 1) * dt;
            node.lazy += dt;
            return;
        }
        int mid = node.start + ((node.end - node.start) >> 1);
        if (node.lazy != 0 && node.start != node.end) {
            node.left.sum += (mid - node.start + 1) * node.lazy;
            node.right.sum += (node.end - mid) * node.lazy;
            node.left.lazy += node.lazy;
            node.right.lazy += node.lazy;
            node.lazy = 0;
        }
        if (l <= mid)
            update(node.left, l, r, dt);
        if (r > mid)
            update(node.right, l, r, dt);
        node.sum = node.left.sum + node.right.sum;
    }

    public static int query(SegmentTree node, int l, int r) {
        if (l <= node.start && r >= node.end) {
            return node.sum;
        }
        int mid = node.start + ((node.end - node.start) >> 1);
        if (node.lazy != 0) {
            node.left.sum += (mid - node.start + 1) * node.lazy;
            node.right.sum += (node.end - mid) * node.lazy;
            node.left.lazy += node.lazy;
            node.right.lazy += node.lazy;
            node.lazy = 0;
        }
        int sum = 0;
        if (l <= mid)
            sum = query(node.left, l, r);
        if (r > mid)
            sum += query(node.right, l, r);
        return sum;
    }
}
```

